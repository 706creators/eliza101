---
title: First Twitter Bot (Draft)
description: 你的第一个Twitter Bot
icon: Twitter
---

## 配置 eliza 环境 (v0.25.9)

```shell
git clone https://github.com/elizaOS/eliza.git
cd eliza
git checkout v0.25.9
```

安装插件

```shell
npx elizaos plugins list    # 列出插件（已安装)
npx elizaos plugins install @elizaos-plugins/client-twitter # 安装插件
```

插件仓库: https://github.com/elizaos-plugins

这个版本的 `eliza` 弱化了 client 的概念，把 client 统一到了 plugin 里边。

install & build :

```shell
node -v
pnpm install
pnpm run build
```

## character 配置

在 character 中配置 llm 的 modelProvider 和 plugins

```json
{
  ...
  "modelProvider": "redpill",
  "plugins": ["@elizaos-plugins/client-twitter"]
  ...
}
```

twitter 相关的 plugin 有两个:

- @elizaos-plugins/client-twitter
- @elizaos-plugins/plugin-twitter
  只包含一个发 twitter 的 Action : POST_TWEET

尝试启动 `Agent`

```shell
pnpm run start --character=characters/eliza101.json
```

这个时候，会报 Env 不存在的错误。

![Image](images/twitter-leak-env.png)

## Env 配置选项

### 1. 基本配置

| 环境变量           | 描述                                                    |
| ------------------ | ------------------------------------------------------- |
| TWITTER_USERNAME   | twitter 用户 id                                         |
| TWITTER_PASSWORD   | 登录密码。如果你是 Gmail 登录过来的，需要单独设置一次。 |
| TWITTER_EMAIL      | 注册邮箱                                                |
| TWITTER_2FA_SECRET | 很重要，最好开启配置。                                  |

配置好以上的选项，就可以登录成功了。

### 2. 高级配置

自动发 Twitter 间隔配置

| 环境变量          | 描述                   | 默认  |
| ----------------- | ---------------------- | ----- |
| POST_INTERVAL_MIN | 最小分钟数             | 90    |
| POST_INTERVAL_MAX | 最大分钟数             | 180   |
| POST_IMMEDIATELY  | 启动后立即发送 twitter | false |

bot 自动发 twitter 的间隔介于 POST_INTERVAL_MIN ~ POST_INTERVAL_MAX 分钟之间。
默认在 90 ~ 180 分钟之间随机发 Twitter。

配置逻辑：[client-twitter/src/post.ts:#L239](https://github.com/elizaos-plugins/client-twitter/blob/1dbcfa726d1e1f0efa6b95946b9e8b04d03167ef/src/post.ts#L239)

```ts title="client-twitter/src/post.ts"
const generateNewTweetLoop = async () => {
  const lastPost = await this.runtime.cacheManager.get<{
    timestamp: number;
  }>("twitter/" + this.twitterUsername + "/lastPost");

  const lastPostTimestamp = lastPost?.timestamp ?? 0;
  const minMinutes = this.client.twitterConfig.POST_INTERVAL_MIN;
  const maxMinutes = this.client.twitterConfig.POST_INTERVAL_MAX;
  const randomMinutes =
    Math.floor(Math.random() * (maxMinutes - minMinutes + 1)) + minMinutes;
  const delay = randomMinutes * 60 * 1000;

  if (Date.now() > lastPostTimestamp + delay) {
    await this.generateNewTweet();
  }

  setTimeout(() => {
    generateNewTweetLoop(); // Set up next iteration
  }, delay);

  elizaLogger.log(`Next tweet scheduled in ${randomMinutes} minutes`);
};
```

Twitter 使用的 client 类库是：https://github.com/elizaOS/agent-twitter-client

## 可能出现的问题

### 1. 插件安装出现网络连接错误

修改 packages/cli/src/index.js 使用 axios 代替 fetch ， 并启动 proxy 配置。

```shell
pnpm install axios
```

替换代码:

```js
async function getPlugins() {
  const resp = await axios.get(
    "https://raw.githubusercontent.com/elizaos-plugins/registry/refs/heads/main/index.json"
  );
  return resp.data;
}
```

### 2. 操作过程中可能遇到网络错误

可以在 Agent 测尝试开启全局代理

```shell
pnpm install undici # 在 agent 中安装依赖
```

agent/src/index.ts 中添加全局代理代码：

```ts
import { ProxyAgent, setGlobalDispatcher } from "undici";
const setProxy = () => {
  const proxy = process.env.AGENT_PROXY;
  if (proxy) {
    elizaLogger.info("start agents use proxy : ", proxy);
    const proxyAgent = new ProxyAgent(proxy);
    setGlobalDispatcher(proxyAgent);
  }
};

setProxy();
```

### 3. 部分日志显示不全

调整日志显示级别

```shell
DEFAULT_LOG_LEVEL=log # 默认是 info
```

全部的日志级别:

```ts
const customLevels: Record<string, number> = {
  fatal: 60,
  error: 50,
  warn: 40,
  info: 30,
  log: 29,
  progress: 28,
  success: 27,
  debug: 20,
  trace: 10,
};
```

### 4. Twitter 账号被锁

登录 Twitter 时候，太频繁会出现账号被锁的情况，日志如下:

```shell
[2025-03-03 09:37:02] ERROR: Login attempt failed: {"errors":[{"code":326,"message":"To protect our users from spam and other malicious activity, this account is temporarily locked. Please log in to https://twitter.com to unlock your account.","sub_error_code":0,"bounce_location":"https://twitter.com/account/access"}]}
```

登录 Twitter 账号解锁。
